---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from "astro:content";
// const allPosts = await Astro.glob('../../pages/blog/*.md');
const ccPosts = await getCollection("credit-cards");
// astro.glob => getCollection is the difference between getting all files from a directory in pages vs. collections
// https://docs.astro.build/en/tutorials/add-content-collections/
import functions from '../../js/functions.js';

const { index, slug } = Astro.props

const slideAnim = {
  old: {
    name: 'slideDown',
    duration: '0.5s',
    easing: 'ease-out',
    fillMode: 'backwards',
  },
  new: {
    name: 'slideUp',
    duration: '0.5s',
    delay: `${index * 0.2 + 0.1}s`,
    easing: 'ease-out',
    fillMode: 'backwards',
  },
}
const verticalSlide = {
  forwards: slideAnim,
  backwards: slideAnim,
}

const res = await fetch("https://pftravelstage.wpengine.com/wp-json/pot/v1/credit-cards/all-posts");
const posts = await res.json();

const combinedPosts = ccPosts.concat(posts);

// let filteredPosts = allPosts.filter(post => post.data.draft === false)
// filteredPosts.sort((a, b) => b.data.pubDate - a.data.pubDate);
// const [firstArticle, ...allArticles] = filteredPosts;
const [firstArticle, ...allArticles] = ccPosts;

// bit-alaska post had a cross at the end of the url which threw a build error in netlify
function removeSpecialCharactersFromURL(url) {
    // Define a regular expression to match special characters
	const regex = /[^\w\s\-#]/gi;
    // Replace special characters with an empty string
    const cleanURL = url.replace(regex, '');
    return cleanURL;
}
---

<Layout title="Prince of Travel | Credit Cards" description="Prince of Travel's latest news, deals, and happenings in the travel space." image={firstArticle.data.imageUrl}>
	<div class="container-fluid px-0">
		<div class="row min-vh-100 bg-light">
			<div class="col-lg-6 d-flex flex-column justify-content-center align-items-center min-vh-500 text-center p-5 mt-5 mt-lg-0 animate-in">
				<span class="badge rounded-pill fw-bold text-bg-secondary py-2 px-4">News</span>
				<h1 class="text-body-secondary fw-900 lh-1 ls-1 mb-4" style="font-size: 9vmin;">{firstArticle.data.title}</h1>
				<p class="col-md-8 fs-5 text-body-secondary mt-0 mb-2">{functions.shorten(firstArticle.data.description, 150) + '...'}</p>
				<div class="py-2">
					<p class="small text-pc-dark text-uppercase fw-bold my-0"><span class="fw-light text-secondary">Written by</span> {firstArticle.data.author}</p>
					<p class="small text-pc-dark text-uppercase fw-bold my-0"><span class="fw-light text-secondary">On</span> {firstArticle.data.pubDate.toString().slice(0,10)}</p>
				</div>
				<a href={`/news/${removeSpecialCharactersFromURL(firstArticle.slug)}/`}>
					<button class="btn btn-dark fw-bold rounded-pill px-4 mt-3 shadow">Read article</button>
				</a>
			</div>
			<div class="col-lg-6">
				<img src={firstArticle.data.imageUrl} class="w-100 h-100" style="object-fit: cover;" alt={firstArticle.data.imageAlt}>
			</div>
		</div>

		<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3 p-4">
			{allArticles?.map((post) => (
			<div class="col">
				<a href={`/news/${post.slug}/`}>
					<div class="card bg-pc-light rounded-4 p-0 border-0 shadow" style="min-height: 500px">
						<img src="" data-src={post.data.imageUrl} class="card-img-top rounded-top-4 w-100" style="object-fit: cover; height: 200px; filter: brightness(70%)" alt={post.data.imageAlt}>
						<i class="bi bi-arrow-up-right-circle-fill text-pc-10 fs-1 position-absolute top-0 end-0 me-3 mt-2"></i>
						<div class="card-body position-relative px-4 pb-4">
							<p class="small mb-2">{post.data.pubDate.toString().slice(0,10)}</p>
							<h5 class="card-title fw-bold mb-0">{post.data.title}</h5>
							<p class="small m-0 text-secondary mt-2 mb-0">By: {post.data.author}</p>
							<p class="card-text text-body-secondary pe-4">{functions.shorten(post.data.description, 150) + '...'}</p>
						</div>
						<div class="card-footer p-3">
							<!--<div class="d-flex flex-row flex-wrap" style="text-wrap: pretty;">
							{post.data.tags.map((tag) => (
								<p class="small text-pc-dark-80 me-1 my-0">#{tag}</p>
							))}
							</div>-->
						</div>
					</div>
				</a>
			</div>
			))}

			{posts?.map((post) => (		
			<div class="col">
				<a href={`/credit-cards/${removeSpecialCharactersFromURL(post.slug)}/`}>
					<div class="card bg-pc-light rounded-4 p-0 border-0 shadow" style="min-height: 500px">
						<img src="" data-src={post.featured_image || '/images/general/pc-hotel-palm-trees.jpeg'} class="card-img-top rounded-top-4 w-100" style="object-fit: cover; height: 200px; filter: brightness(70%)" alt="">
						<i class="bi bi-arrow-up-right-circle-fill text-pc-10 fs-1 position-absolute top-0 end-0 me-3 mt-2"></i>
						<div class="card-body position-relative px-4 pb-4">
							<p class="small mb-2">{post.date.toString().slice(0,10)}</p>
							<h5 class="card-title fw-bold mb-0"><Fragment set:html={post.title} /></h5>
							<!--<p class="small m-0 text-secondary mt-2 mb-0">By: {post.author}</p>-->
							<p class="small m-0 text-secondary mt-2 mb-0"><Fragment set:html={post.reward_points} /></p>
							<p class="small m-0 text-secondary my-0"><Fragment set:html={post.fees} /></p>
              <ul class="text-secondary mt-2">
                <li><Fragment set:html={post.features_0_feature} /></li>
                <li><Fragment set:html={post.features_1_feature} /></li>
                <li><Fragment set:html={post.features_2_feature} /></li>
              </ul>

							<!--<p class="card-text text-body-secondary pe-4">{functions.shorten(post.excerpt, 150) + '...'}</p>-->
						</div>
            <div class="d-inline">
            <button class="btn btn-sm btn-secondary">Details</button>
            </div>
					</div>
				</a>
			</div>
			))}		
		</div>
	</div>
</Layout>


<script>	
	
var myModal = new bootstrap.Modal(document.getElementById("exampleModal"), {});

// var modal = document.getElementById('exampleModal');

// myModal.addEventListener('click', updateURL);

// myModal.addEventListener('click', revertURL);

// function updateURL(slug) {
// 	myModal.show();
// 	const newURL = `/news/${slug}`;
// 	window.history.pushState({}, '', newURL);
// }
// function revertURL() {
// 	myModal.hide();
// 	window.history.back();
// }

// window.addEventListener('popstate', function () {
// var modalInstance = bootstrap.Modal.getInstance(modal);
// if (modalInstance) {
// modalInstance.hide();
// }
// });

</script>
        
<style>
.grid {
  display: grid;
  /* grid-template-columns: var(--col);
  grid-template-rows: var(--row); */
  /* grid-template-columns: 300px 1fr 2fr; */
  gap: 15px;
}
.grid-1 {
   display: grid;
   grid-template-columns: 1fr 1fr 2fr;
   grid-template-rows: auto;
}
.grid-2 {
   display: grid;
   grid-template-columns: 3fr, 1fr;
   grid-template-rows: auto;
}
</style>